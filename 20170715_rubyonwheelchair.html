<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="author" content="Daniel Bovensiepen" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/style.css" />
<title>Daniel Bovensiepen Li</title>
</head>
<body>
<div class="container">
  <div class="row">
    <div class="one column"><h1><a href="https://daniel.bovensiepen.li">Daniel Bovensiepen Li</a></h1></div>
  </div>
  <div class="row">
    <div class="one column">
      <p>This articles was published on 2017-07-15</p>
      <h2>RubyOnWheelchair</h2>
<p>Last month I gave a talk at <a href="http://www.reddotrubyconf.com">RedDotRubyConf in Singapore</a> with the title <a href="http://www.reddotrubyconf.com/#bovensiepen">RubyOnWheelchair</a>. You can see the complete talk here (for China here is the video on <a href="http://v.youku.com/v_show/id_XMjg5Mzk3NzQ0NA==.html?spm=a2hzp.8244740.0.0">YouKu</a>):</p>
<p><iframe src="https://www.youtube.com/embed/b5DFKEYA7AU?autoplay=1" width="560" height="315" allowfullscreen="allowfullscreen"></iframe></p>
<p>As there were several questions regarding the content I would like to address some of them here.</p>
<h3>Hardware foundation</h3>
<p>So what kind of hardware did I use? The wheelchair itself is from Jerry Medical and was bought straight from <a href="https://item.taobao.com/item.htm?spm=a230r.1.14.81.ebb2eb2UYl1cw&amp;id=550021394026&amp;ns=1&amp;abbucket=8#detail">Taobao</a> for ~2000RMB.</p>
<p><a href="/files/img_0305.jpg"><img class="alignnone size-medium wp-image-41" title="" src="/files/img_0305.jpg" alt="" width="381" height="300" srcset="/files/img_0305.jpg 1235w, /files/img_0305-300x236.jpg 300w, /files/img_0305-768x604.jpg 768w, /files/img_0305-1024x806.jpg 1024w" sizes="(max-width: 381px) 100vw, 381px" /></a></p>
<p>The electrical motors used inside of the chair are <a href="https://item.taobao.com/item.htm?spm=a230r.1.14.1.ebb2eb2sGbn7s&amp;id=520022177892&amp;ns=1&amp;abbucket=8#detail">MY1016Z-250W24V</a>, which is probably the most common one in China for scooters, wheelchairs and the ultra-tiny electrical vehicles which are quite popular these days. Price point for one piece is ~100RMB and a wheelchair comes with two pieces (who would have thought? :-).</p>
<p><a href="/files/img_0306.jpg"><img class="alignnone size-medium wp-image-43" title="" src="/files/img_0306.jpg" alt="" width="328" height="300" srcset="/files/img_0306.jpg 1180w, /files/img_0306-300x274.jpg 300w, /files/img_0306-768x702.jpg 768w, /files/img_0306-1024x935.jpg 1024w" sizes="(max-width: 328px) 100vw, 328px" /></a></p>
<p>The motor controller I added to drive each motor was <a href="https://item.taobao.com/item.htm?spm=a230r.1.999.25.ebb2eb2mJoSAV&amp;id=39342287358&amp;ns=1#detail">AQMH3615NS</a> and cost ~60RMB. I used one piece for each motor.</p>
<p><a href="/files/img_0308-1.jpg"><img class="alignnone size-medium wp-image-46" title="" src="/files/img_0308-1.jpg" alt="" width="315" height="300" srcset="/files/img_0308-1.jpg 1137w, /files/img_0308-1-300x285.jpg 300w, /files/img_0308-1-768x730.jpg 768w, /files/img_0308-1-1024x974.jpg 1024w" sizes="(max-width: 315px) 100vw, 315px" /></a></p>
<p>For prototyping the software I used <a href="https://item.taobao.com/item.htm?spm=a230r.1.14.75.ebb2eb2c9no0E&amp;id=545483095951&amp;ns=1&amp;abbucket=8#detail">a development board</a> for the ESP32 which was ~34RMB.</p>
<p><a href="/files/img_0312.jpg"><img class="alignnone size-medium wp-image-47" title="" src="/files/img_0312.jpg" alt="" width="330" height="300" srcset="/files/img_0312.jpg 1318w, /files/img_0312-300x272.jpg 300w, /files/img_0312-768x696.jpg 768w, /files/img_0312-1024x928.jpg 1024w" sizes="(max-width: 330px) 100vw, 330px" /></a></p>
<p>Finally I ported the low-level control code to a STM32 based microcontroller board due to the reason that I want in the future to interface the low-level controller via ethernet instead of serial. This board set me back ~180RMB.</p>
<p><a href="/files/img_0313-1-1.jpg"><img class="alignnone size-medium wp-image-50" title="" src="/files/img_0313-1-1.jpg" alt="" width="362" height="300" srcset="/files/img_0313-1-1.jpg 1553w, /files/img_0313-1-1-300x248.jpg 300w, /files/img_0313-1-1-768x635.jpg 768w, /files/img_0313-1-1-1024x847.jpg 1024w" sizes="(max-width: 362px) 100vw, 362px" /></a></p>
<p>For object avoidance I used the <a href="http://www.slamtec.com/en/Lidar">RPLidar</a> A1 which was ~1000RMB. This device is now legacy and the new version of it is A2.</p>
<p><a href="/files/img_0314.jpg"><img class="alignnone size-medium wp-image-51" title="" src="/files/img_0314.jpg" alt="" width="357" height="300" srcset="/files/img_0314.jpg 967w, /files/img_0314-300x252.jpg 300w, /files/img_0314-768x645.jpg 768w" sizes="(max-width: 357px) 100vw, 357px" /></a></p>
<p>The core of the wheelchair control was just a <a href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b/">RaspberryPi 3 Model B</a> which is priced these days at ~180RMB</p>
<p><a href="/files/img_0315.jpg"><img class="alignnone size-medium wp-image-52" title="" src="/files/img_0315.jpg" alt="" width="495" height="300" srcset="/files/img_0315.jpg 1464w, /files/img_0315-300x182.jpg 300w, /files/img_0315-768x465.jpg 768w, /files/img_0315-1024x620.jpg 1024w" sizes="(max-width: 495px) 100vw, 495px" /></a></p>
<p>The hardware architecture I ended up with looked like this:</p>
<p><a href="/files/img_0321.jpg"><img class="alignnone size-medium wp-image-63" title="" src="/files/img_0321.jpg" alt="" width="538" height="300" srcset="/files/img_0321.jpg 2048w, /files/img_0321-300x167.jpg 300w, /files/img_0321-768x428.jpg 768w, /files/img_0321-1024x571.jpg 1024w" sizes="(max-width: 538px) 100vw, 538px" /></a></p>
<h3>Software Foundation</h3>
<p>The main focus for me was the software part, which is heavily based on Ruby. First and foremost I used mruby directly on the ESP32 and the STM32. I have talked in 2013 about <a href="https://www.slideshare.net/mobile/bovi/shrink-to-grow">how to cross-compile and run mruby on an ARM Cortex M3</a>.</p>
<p><a href="https://www.slideshare.net/mobile/bovi/shrink-to-grow"><img class="alignnone size-medium wp-image-54" title="" src="/files/img_0316.jpg" alt="" width="399" height="300" srcset="/files/img_0316.jpg 1507w, /files/img_0316-300x225.jpg 300w, /files/img_0316-768x576.jpg 768w, /files/img_0316-1024x769.jpg 1024w" sizes="(max-width: 399px) 100vw, 399px" /></a></p>
<p>The STM32F4, which I used, is an ARM Cortex M4, so this guide from the past is still valid today. As a matter of fact our cross-compiling toolchain of mruby improved quite a bit and today it is even easier to bring Ruby to these microcontrollers. If you are interested, have a look at mruby&#8217;s <a href="https://github.com/mruby/mruby/tree/master/examples/targets">example toolchains</a> included in our repository.</p>
<p>Running mruby on the ESP32 is equally simple. I was quite lucky to get some early pre-production examples of the ESP32 from Espressif in the beginning of 2016. The SDK itself had at this point many issues but it was possible for me to port mruby on it. This showed that we could finally have an ultra-low-cost MCU which runs mruby (the esp8266 is sadly to small). Since then the final production version of the ESP32 was released and the SDK became mature. <a href="https://github.com/pandax381">YAMAMOTO Masaya</a> and <a href="https://github.com/carsonmcdonald">Carson McDonald</a> made excellent progress on building a proper <a href="https://github.com/mruby-esp32">ESP32 mruby integration</a>. After <a href="https://github.com/mruby-esp32/mruby-esp32/issues/7">talking to them</a> some time ago they even made the effort to extract a couple of great mgems (<a href="https://github.com/mruby-esp32/mruby-esp32-wifi">wifi</a>, <a href="https://github.com/mruby-esp32/mruby-esp32-system">system</a>, <a href="https://github.com/mruby-esp32/mruby-esp32-gpio">gpio</a>, <a href="https://github.com/mruby-esp32/mruby-esp32-i2c">I2C</a>) specially for the ESP32. I moved all my later work for the ESP32 to their codebase. Thank you guys!</p>
<p><a href="/files/img_0320.jpg"><img class="alignnone size-medium wp-image-58" title="" src="/files/img_0320.jpg" alt="" width="541" height="300" srcset="/files/img_0320.jpg 2048w, /files/img_0320-300x166.jpg 300w, /files/img_0320-768x425.jpg 768w, /files/img_0320-1024x567.jpg 1024w" sizes="(max-width: 541px) 100vw, 541px" /></a></p>
<p>The final architecture of the wheelchair looked in the end like this:</p>
<p><a href="/files/img_0322.jpg"><img class="alignnone size-medium wp-image-64" title="" src="/files/img_0322.jpg" alt="" width="539" height="300" srcset="/files/img_0322.jpg 2048w, /files/img_0322-300x167.jpg 300w, /files/img_0322-768x427.jpg 768w, /files/img_0322-1024x569.jpg 1024w" sizes="(max-width: 539px) 100vw, 539px" /></a></p>
<h4>Still using MRI</h4>
<p>Even though that every Ruby implementation works hard to become the best it can be, I always promote the idea of specializiation. mruby is not better or worse than <a href="https://github.com/ruby/ruby">MRI</a> or <a href="https://github.com/jruby/jruby">JRuby</a>. It is different in it&#8217;s own way and opens a new field for Ruby, which the other implementations are rightfully not adressing. During my presentation I draw the following diagram:</p>
<p><a href="/files/img_0317.jpg"><img class="alignnone size-medium wp-image-55" title="" src="/files/img_0317.jpg" alt="" width="539" height="300" srcset="/files/img_0317.jpg 2048w, /files/img_0317-300x167.jpg 300w, /files/img_0317-768x427.jpg 768w, /files/img_0317-1024x569.jpg 1024w" sizes="(max-width: 539px) 100vw, 539px" /></a></p>
<p>We can argue how accurate this picture is. For example OpenStreetMap is running on MRI and has no plan to move to JRuby and the Lidar.rb system I wrote could easily be used on mruby itself. Yet the main message I want to give out with this is, that Ruby is in an unique position by now. We have tools for very enterprisy applications. We have tools to hack away with crazy features (e.g. Refinements) and a huge amount of Rubygems for any kind of practical problems. And then we have mruby which allows us to use the same language we know so well in the embedded field, which was dominated by low-level languages before.</p>
<p>I don&#8217;t want to make the point that you shouldn&#8217;t mix the tools with different use-cases. Go for it and use JRuby in embedded device (e.g. <a href="https://github.com/ruboto/ruboto">Android</a>). Go for it and use mruby for complex application setups (e.g. <a href="http://haconiwa.mruby.org">Container management</a>).</p>
<p>The point I want to make is, that there is now such a wide and mature tooling available around Ruby that the space of use-cases which can&#8217;t be addressed with Ruby is dramatically lower than most people assume. I even claim that there is no use-case available anymore which you couldn&#8217;t solve with Ruby, yet there are good reasons to use different tools all the time. I actually use many other systems in my daily work next to Ruby! Feel free to choose, now you really have the freedom.</p>
<h3>EveryoneOnWheelchair</h3>
<p>The slide which gave the most mumbling during my talk was this one here:</p>
<p><a href="/files/img_0318.jpg"><img class="alignnone size-medium wp-image-56" title="" src="/files/img_0318.jpg" alt="" width="537" height="300" srcset="/files/img_0318.jpg 2048w, /files/img_0318-300x168.jpg 300w, /files/img_0318-768x429.jpg 768w, /files/img_0318-1024x572.jpg 1024w" sizes="(max-width: 537px) 100vw, 537px" /></a></p>
<p>I was hoping for a lot of resonance about this but actually after the presentation itself nobody I talked to questioned or challenged this final note. So I guess I didn&#8217;t made it clear enough or I&#8217;m just wrong in my assumption that this is the way to go. So let&#8217;s iterate about the idea one last time.</p>
<p>The claim during my talk was, that most involvement into the topic of accessiblity is coming from needs. If I need a wheelchair because I&#8217;m not able to move otherwise, I will invest time and money into this topic. If I&#8217;m not relying on it I will hardly think and quite likely never act on this problem. I&#8217;m a pessimist when it comes to the crowd. My conviction is, that the majority of people will not change the infrastructure around them to solve the problems of the few (even though that sooner or later they will belong to these &#8220;few&#8221;).</p>
<p>This is not to blame anyone but me. I also don&#8217;t believe that we can change the issue of crappy infrastructure for wheelchairs by blaming everyone who doesn&#8217;t care.</p>
<p>So my strategy to solve the problem is to just bring the need of proper infrastructure to everyone. By making a wheelchair which is so cool that you actually prefer to drive in it than to walk. At work I already have a setup where I sit in my wheelchair and drive between my work desk and my lab instead of walking. After having implemented the automatic path control this setup will not only be more comfortable, it will be faster (you would wonder how fast a wheelchair can drive), more efficient (having permanent power and my notebook on me all the time) and more safe (did you ever count how often you bump into someone or something when walking and staring at your phone?). Instead of promoting bicycles, segways or mini-EVs we should promote wheelchairs which don&#8217;t need power to balance themselve, which occupy only the space of one human and (most importantly) which are compatible to the needs of existing wheelchair users who might not be able to choose other means of transportation.</p>
<h4>Wheelchair &lt;&gt; (Bicycle|Pedestrian|Car)</h4>
<p>With this we come also to the conclusion that the needs of a Wheelchair are drastically different to the one&#8217;s from a Bicycle, a Pedestrian and even a Car. For example we will need different kinds of navigation:</p>
<p><a href="/files/img_0319-2.jpg"><img class="alignnone size-medium wp-image-61" title="" src="/files/img_0319-2.jpg" alt="" width="540" height="300" srcset="/files/img_0319-2.jpg 2048w, /files/img_0319-2-300x166.jpg 300w, /files/img_0319-2-768x426.jpg 768w, /files/img_0319-2-1024x568.jpg 1024w" sizes="(max-width: 540px) 100vw, 540px" /></a></p>
<p>There are a lot of challenges in actually building a wheelchair which can safely, comfortable and stylish transport people. Certainly it is more difficult than building a car which only drives on a perfect concrete path where confused pedestrians, piles of garbage, wild/domestic animals and no signage are the exception. For wheelchairs these are the norm.</p>
<p>So if you search for a difficult problem to solve, ignore autonomous guided cars. This problem is essentially solved. The real challenge in the AGV domain are autonomous guided wheelchairs.</p>

    </div>
  </div>
</div>
</body>
</html>
